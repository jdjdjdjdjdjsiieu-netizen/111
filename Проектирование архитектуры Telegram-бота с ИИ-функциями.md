# Проектирование архитектуры Telegram-бота с ИИ-функциями

## 1. Общая концепция и цель
Цель архитектуры — создать **масштабируемого, надежного и автономного** рекомендательного Telegram-бота, который будет максимизировать доход владельца в проекте "Свой в Альфе" при минимальном его участии. Ключевым элементом является **AI Module**, который берет на себя функции персонализированного подбора продуктов и генерации контента для рекрутинга.

## 2. Современная Архитектура (Модульный подход)

Для обеспечения гибкости и масштабируемости выбрана модульная архитектура, основанная на асинхронном фреймворке `aiogram` (Python).

### 2.1. Структурная схема

```mermaid
graph TD
    subgraph User_Interaction
        A[Telegram User] --> B(Telegram Bot API)
        B --> C{Bot Core (aiogram)}
    end

    subgraph Bot_Backend
        C --> D[Business Logic Layer]
        D --> E(AI Module - LLM API)
        D --> F[Database (PostgreSQL/SQLite)]
        D --> G[Partner Links Storage]
    end

    subgraph AI_Services
        E --> H[OpenAI/Other LLM Service]
    end

    subgraph External_Systems
        G --> I[Alfa-Bank Partner Cabinet (Simulated)]
    end
```

### 2.2. Описание модулей

| Модуль | Технология/Функция | Ответственность |
| :--- | :--- | :--- |
| **Telegram Bot API** | Внешний интерфейс Telegram | Прием и отправка сообщений, обработка команд. |
| **Bot Core (aiogram)** | Python, Асинхронный фреймворк | Обработка событий, маршрутизация запросов, управление состояниями (FSM). |
| **Business Logic Layer (BLL)** | Python | Содержит основную логику: управление воронками продаж/рекрутинга, расчеты, взаимодействие с БД и ИИ-модулем. |
| **AI Module** | Python, OpenAI API (или аналог) | **Ключевая функция:** Анализ потребностей клиента (пользователя ТГ) и генерация персонализированной рекомендации продукта с высоким баллом. Генерация контента для рекрутинга. |
| **Database (DB)** | PostgreSQL (рекомендовано для масштаба) | Хранение данных: профили пользователей, их ответы на вопросы, история рекомендаций, статус активации продуктов, данные партнеров (2-я/3-я линии). |
| **Partner Links Storage** | Часть DB или отдельный сервис | Хранение уникальных партнерских ссылок владельца бота для каждого продукта. |

## 3. Ключевые ИИ-функции и их реализация

### 3.1. Персонализированная рекомендация продукта (Core)
1.  **Сбор данных:** Бот задает пользователю серию вопросов (возраст, цель, наличие продуктов Альфа-Банка, кредитная история).
2.  **Анализ:** BLL отправляет собранные данные в **AI Module**.
3.  **LLM-запрос:** AI Module использует LLM (например, `gpt-4.1-mini`) с подробным промптом, включающим:
    *   **Контекст:** Маркетинг-план "Свой в Альфе" (баллы, условия активации).
    *   **Данные клиента:** Ответы пользователя.
    *   **Цель:** Выбрать **наиболее баллоемкий** продукт, который **максимально соответствует** потребностям клиента.
4.  **Результат:** LLM возвращает код продукта и персонализированный текст-рекомендацию.

### 3.2. Автоматизированный рекрутинг и онбординг
1.  **Воронка рекрутинга:** Пользователь, выразивший интерес к заработку, переводится в отдельную воронку.
2.  **Генерация контента:** AI Module генерирует мотивирующий и обучающий контент (FAQ, пошаговые инструкции, разбор маркетинг-плана) на основе запросов новичка.
3.  **Минимальное участие:** Владелец бота только предоставляет свою реферальную ссылку для регистрации новых партнеров.

## 4. Требования к минимальному участию владельца
Для достижения цели "минимальное участие" владельцу бота необходимо будет выполнить только следующие действия:
1.  **Первоначальная настройка:** Предоставить API-токен Telegram, API-ключ OpenAI и свои партнерские ссылки "Свой в Альфе".
2.  **Мониторинг:** Периодически проверять статистику (количество рекомендаций, конверсия) через административный интерфейс бота.
3.  **Масштабирование:** При необходимости, инвестировать в привлечение трафика в Telegram-бота.

Таким образом, бот берет на себя всю рутинную работу по консультации, подбору продукта, генерации контента и первичному онбордингу партнеров.
